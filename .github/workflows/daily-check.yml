name: GitHub Daily Contribution Checker

on:
  schedule:
    - cron: '0 15 * * *' # 9 PM Bangladesh
  workflow_dispatch:

jobs:
  check-contribution:
    runs-on: ubuntu-latest

    steps:
      - name: Check GitHub push activity today (BD time)
        id: check
        run: |
          # Get Bangladesh date (YYYY-MM-DD)
          bd_today=$(TZ=Asia/Dhaka date +"%Y-%m-%d")

          # Fetch last 100 events (authenticated)
          events=$(curl -s \
            -H "Authorization: Bearer ${{ secrets.GITHUB_TOKEN }}" \
            https://api.github.com/users/${{ github.actor }}/events?per_page=100)

          # Count PushEvents created today (BD date)
          count=$(echo "$events" | jq --arg date "$bd_today" '
            [.[] 
              | select(.type=="PushEvent")
              | select(.created_at | startswith($date))
            ] | length
          ')

          echo "count=$count" >> $GITHUB_OUTPUT

      - name: Send Telegram alert if no push
        if: steps.check.outputs.count == '0'
        run: |
          curl -s -X POST https://api.telegram.org/bot${{ secrets.TELEGRAM_BOT_TOKEN }}/sendMessage \
            -d chat_id=${{ secrets.TELEGRAM_CHAT_ID }} \
            -d text="ğŸš¨ No GitHub push today!\nâ° Time: 9 PM (BD)\nGo commit something ğŸ’ªğŸ”¥"
