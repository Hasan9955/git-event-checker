name: GitHub Daily Contribution Checker

on:
  schedule:
    - cron: '0 15 * * *' # 9 PM Bangladesh
  workflow_dispatch:

jobs:
  check-contribution:
    runs-on: ubuntu-latest

    steps:
      - name: Check GitHub contributions today
        id: check
        run: |
          # Bangladesh day range
          start=$(date -u -d "today 00:00 +6 hours" +"%Y-%m-%dT%H:%M:%SZ")
          end=$(date -u -d "today 23:59 +6 hours" +"%Y-%m-%dT%H:%M:%SZ")

          count=$(curl -s \
            -H "Authorization: Bearer ${{ secrets.GITHUB_TOKEN }}" \
            "https://api.github.com/search/commits?q=author:${{ github.actor }}+committer-date:$start..$end" \
            | jq '.total_count')

          echo "count=$count" >> $GITHUB_OUTPUT

      - name: Send Telegram alert if no contribution
        if: steps.check.outputs.count == '0'
        run: |
          curl -s -X POST https://api.telegram.org/bot${{ secrets.TELEGRAM_BOT_TOKEN }}/sendMessage \
            -d chat_id=${{ secrets.TELEGRAM_CHAT_ID }} \
            -d text="ğŸš¨ No GitHub contribution today!\nâ° Time: 9 PM (BD)\nGo commit something ğŸ’ªğŸ”¥"
